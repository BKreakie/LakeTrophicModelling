---
title: 'Modeling Lake Trophic State: A Data Mining Approach'
author: 
- name: Jeffrey W. Hollister
  affilnum: 1
  email: hollister.jeff@epa.gov
- name: W. Bryan Milstead
  affilnum: 1
- name: Betty J. Kreakie
  affilnum: 1
affiliation:
- affilnum: 1
  affil: US Environmental Protection Agency, Office of Research and Development, National     Health and Environmental Effects Research Laboratory, Atlantic Ecology Division, 27 Tarzwell Drive  Narragansett, RI, 02882, USA
output:
  pdf_document:
    fig_caption: yes
    keep_tex: yes
    number_sections: yes
    template: components/manuscript.latex
fontsize: 11pt
capsize: normalsize
csl: components/ecology.csl
documentclass: article
spacing: doublespacing
linenumbers: yes
bibliography: components/LakeTrophicModelling.bib
abstract: no
---

<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{Modeling Lake Trophic State: A Data Mining Approach}
-->

```{r setup, include=FALSE, echo=FALSE}
devtools::install_github("USEPA/LakeTrophicModelling",quick=TRUE,
                        auth_token="8742a8c1c2207393659a1de1bd53527fa56ea0d7")
devtools::install_github("jhollist/wesanderson")
library("wesanderson")
library("LakeTrophicModelling")
library("knitr")
library("ggplot2")
library("sp")
library("rgdal")
library("e1071")
library("dplyr")
library("tidyr")
opts_chunk$set(dev = 'pdf', fig.width=6, fig.height=4.3)
data(LakeTrophicModelling)

#Checks for existing cache (from another project)
if(file.exists("prior_cache")){
  for(i in gsub(".rdb","",list.files("prior_cache",".rdb",full.names=T))){
    lazyLoad(i)
  }
}

# Table Captions from @DeanK on 
#http://stackoverflow.com/questions/15258233/using-table-caption-on-r-markdown-file-using-knitr-to-use-in-pandoc-to-convert-t

knit_hooks$set(tab.cap = function(before, options, envir) {
                  if(!before) { 
                    paste('\n\n:', options$tab.cap, sep='') 
                  }
                })
default_output_hook = knit_hooks$get("output")
knit_hooks$set(output = function(x, options) {
  if (is.null(options$tab.cap) == FALSE) {
    x
  } else
    default_output_hook(x,options)
})
```

```{r analysis , eval=FALSE, include=FALSE, echo=FALSE, cache=FALSE}
################################################################################
#All analysis in here, that way all bits of paper have access to final objects
#Tables, figures, and numerical results placed at end of paper.
#Included for completeness.  Results already run in another project
#Those results loaded via lazyLoad in setup chunk
#This chunk takes several days to complete - DO NOT EDIT!!!
################################################################################
#Model 1: All Variables, 4 Trophic State Classes
  #Variable Selction
  all_ts4<-iterVarSelRF(ltmData[predictors_all],ltmData$TS_CHLA_4,numCore=4,100,
        								ntree=10000,ntreeIterat=5000,vars.drop.frac=NULL,
  											vars.drop.num=1,outStr="all_ts4",time=TRUE)
  #Random Forest
  all_ts4_vars<-unique(unlist(all_ts4[1:100]))
  all_ts4_rf<-runRandomForest(ltmData[all_ts4_vars],ltmData$TS_CHLA_4, 
                              ntree=10000,importance=TRUE,proximity=TRUE)
################################################################################
#Model 2: All Variables, 3 Trophic State Classes
  #Variable Selction
  all_ts3<-iterVarSelRF(ltmData[predictors_all],ltmData$TS_CHLA_3,numCore=4,100,
      									ntree=10000,ntreeIterat=5000,vars.drop.frac=NULL,
  											vars.drop.num=1,outStr="all_ts3",time=TRUE)
  #Random Forest
  all_ts3_vars<-unique(unlist(all_ts3[1:100]))
  all_ts3_rf<-runRandomForest(ltmData[all_ts3_vars],ltmData$TS_CHLA_3, 
                              ntree=10000,importance=TRUE,proximity=TRUE)
################################################################################
#Model 3: All Variables, 2 Trophic State Classes
  #Variable Selction
  all_ts2<-iterVarSelRF(ltmData[predictors_all],ltmData$TS_CHLA_2,numCore=4,100,
      									ntree=10000,ntreeIterat=5000,vars.drop.frac=NULL,
  											vars.drop.num=1,outStr="all_ts2",time=TRUE)
  
  #Random Forest
  all_ts2_vars<-unique(unlist(all_ts2[1:100]))
  all_ts2_rf<-runRandomForest(ltmData[all_ts2_vars],ltmData$TS_CHLA_2, 
                              ntree=10000,importance=TRUE,proximity=TRUE)
################################################################################
#Model 4: GIS Only Variables, 4 Trophic State Classes
  #Variable Selction
  gis_ts4<-iterVarSelRF(ltmData[predictors_gis],ltmData$TS_CHLA_4,numCore=4,100,
          							ntree=10000,ntreeIterat=5000,vars.drop.frac=NULL,
  											vars.drop.num=1,outStr="gis_ts4",time=TRUE)
  
  #Random Forest
  gis_ts4_vars<-unique(unlist(gis_ts4[1:100]))
  gis_ts4_rf<-runRandomForest(ltmData[gis_ts4_vars],ltmData$TS_CHLA_4, 
                              ntree=10000,importance=TRUE,proximity=TRUE)
################################################################################
#Model 5: GIS Only Variables, 3 Trophic State Classes
  #Variable Selction
  gis_ts3<-iterVarSelRF(ltmData[predictors_gis],ltmData$TS_CHLA_3,numCore=4,100,
        								ntree=10000,ntreeIterat=5000,vars.drop.frac=NULL,
  											vars.drop.num=1,outStr="gis_ts3",time=TRUE)
  
  #Random Forest
  gis_ts3_vars<-unique(unlist(gis_ts3[1:100]))
  gis_ts3_rf<-runRandomForest(ltmData[gis_ts3_vars],ltmData$TS_CHLA_3, 
                              ntree=10000,importance=TRUE,proximity=TRUE)
################################################################################
#Model 6: GIS Only Variables, 2 Trophic State Classes
  #Variable Selction
  gis_ts2<-iterVarSelRF(ltmData[predictors_gis],ltmData$TS_CHLA_2,numCore=4,100,
      									ntree=10000,ntreeIterat=5000,vars.drop.frac=NULL,
  											vars.drop.num=1,outStr="gis_ts2",time=TRUE)
  #Random Forest
  gis_ts2_vars<-unique(unlist(gis_ts2[1:100]))
  gis_ts2_rf<-runRandomForest(ltmData[gis_ts2_vars],ltmData$TS_CHLA_2, 
                              ntree=10000,importance=TRUE,proximity=TRUE)

```

```{r summaryStats, eval=TRUE, echo=FALSE, cache=TRUE, warning=FALSE}
acc_results<-data.frame(model_number=c("Model 1","Model 2","Model 3","Model 4","Model 5","Model 6"),
                        total_accuracy=c(classAgreement(all_ts4_rf$confusion[,1:4])$diag,
                                         classAgreement(all_ts3_rf$confusion[,1:3])$diag,
                                         classAgreement(all_ts2_rf$confusion[,1:2])$diag,
                                         classAgreement(gis_ts4_rf$confusion[,1:4])$diag,
                                         classAgreement(gis_ts3_rf$confusion[,1:3])$diag,
                                         classAgreement(gis_ts2_rf$confusion[,1:2])$diag),
                        kappa_coeff=c(classAgreement(all_ts4_rf$confusion[,1:4])$kappa,
                                         classAgreement(all_ts3_rf$confusion[,1:3])$kappa,
                                         classAgreement(all_ts2_rf$confusion[,1:2])$kappa,
                                         classAgreement(gis_ts4_rf$confusion[,1:4])$kappa,
                                         classAgreement(gis_ts3_rf$confusion[,1:3])$kappa,
                                         classAgreement(gis_ts2_rf$confusion[,1:2])$kappa))
var_importance<-rbind_list(varImportance(all_ts4_rf,"Model 1"),
                           varImportance(all_ts3_rf,"Model 2"),
                           varImportance(all_ts2_rf,"Model 3"),
                           varImportance(gis_ts4_rf,"Model 4"),
                           varImportance(gis_ts3_rf,"Model 5"),
                           varImportance(gis_ts2_rf,"Model 6"))
var_importance$variable_names<-factor(var_importance$variable_names)
#var_importance$model_id<-factor(var_importance$model_id)
var_importance<-inner_join(var_importance,data_def[c("variable_names","description")],"variable_names")
var_importance<-var_importance[order(var_importance$model_id,-var_importance$mean_decrease_gini, decreasing=FALSE),]                     
                        
```

\singlespace

\vspace{2mm}\hrule

**Abstract**  
Productivity of lentic ecosystems has been well studied and it is widely accepted that as nutrient inputs increase,  productivity increases and lakes transition from low trophic state (e.g. oligotrophic) to higher trophic states  (e.g. eutrophic). These broad trophic state classifications are good predictors of ecosystem health and ecosystem services/disservices (e.g. recreation, aesthetics, fisheries, and harmful algal blooms). While the relationship between  nutrients and trophic state provides reliable predictions, it requires *in situ* water quality data in order to paramterize the model.  This limits the application of these models to lakes with existing and, more importanly, available water quality data.  To expand our ability to predict in lakes without water quality data, we take advantage of the availability of a large national lakes water quality database, land use/land cover data, lake morphometry data, other universally available data, and modern data mining approaches to build and assess models of lake tropic state that may be more universally applied.  We use random forests and random forest variable selection to identify variables to be used for predicting trophic state and we compare the performance of two models of trophic state (as determined by chlorophyll *a* concentration).   The first model estimates trophic state with *in situ* as well as universally available data and the second model uses universally available data only. For each of these models we used three separate trophic state categories, for a total of six models. Overall accuracy for models buils from *in situ* and universal data ranged from `r round(min(acc_results[1:3,2]),3)`% to `r round(max(acc_results[1:3,2]),3)`%.  For the universal data only models, Overall accuraccy ranged from `r round(min(acc_results[4:6,2]),3)`% to `r round(max(acc_results[4:6,2]),3)`%. Lastly, it is believed that the presence and abundance of cyanobacteria is strongly associated with trophic state.  To test this we examine the association between estimates of cyanobacteria biovolume and the measured and predicted trophic state and find a positive relationship.  Expanding these preliminary results to include cyanobacteria taxa indicates that cyanobacteria are significantly more likely to be found in highly eutrophic lakes. These results suggest that predictive models of lake trophic state may be improved with additional information on the landscape surrounding lakes and that those models provide additional information on the presence of potentially harmful cyanobacteria taxa. 

\vspace{3mm}\hrule
\doublespace



#Introduction
Productivity in lentic systems is often categorized across a range of tropic states (e.g. the tropic continuum) from early succesional (i.e. oligotrophic)to late successional lakes (i.e. hypereutrophic) [@carlson1977trophic] and lakes naturally occur across this range. Naturally oligotrophic lakes occur in nutrient poor areas or have a more recent geologic history.  These lakes are often found in higher elevations, have clear water, and are often favored for drinking water or direct contact recreation (e.g. swimming).   Lakes with higher productivity (e.g. eutrophic lakes) have greater nutrient loads, tend to be less clear, have greater density of aquatic plants, and often support more diverse and abundant fish communities. Higher primary productivity is not necessarily a predictor of poor ecological condition.   

It is natural for lakes to shift from lower to higher trophic states but this is a slow process.  Given this fact, monitoring trophic state allows the identification of rapid shifts in trophic state or locating lakes with unusually high productivity (e.g. hypereutrophic).  These cases are indicative of lakes under greater anthropogenic nutrient loads, also known as cultural eutrophication, and are more likely to be at risk of fish kills, fouling, and harmful algal blooms[@smith1998cultural;@smith1999eutrophication;@smith2006eutrophication].  Given the association between trophic state and many ecosystem services and disservices, being able to model trophic state could allow for estimating trophic state in unmonitored lakes and provide a first cut at identifying lakes with the potential for harmful algal blooms and other problems associated with cultural eutrophication.  

As trophic state can be defined by a number of *in situ* water quality measurements, most models have used this information as predictors.  This leads to accurate models, but also requires data that is sparse and not always availble, limiting the population of lakes that can be modeled.  Landscape data is ubiqutious ...


We have three goals for this preliminary research.  First, we build and assess multiple models of lake trophic state using a full suite of data including *in situ* water quality and universally available data (e.g. landscape data). Second, we assess the accuracy of predicted trophic state in lakes with only the universally available data.  Lastly, we explore associations between trophic state and cyanobacteria to explore.

#Methods

##Data and Study Area
We utilize four primary sources of data for this study,the National Lakes Assessment (NLA), the National Lake Cover Dataset (NLCD), modeled lake morphometery,  and estimated cyanobacteria biovolumes [@usepa2009national;@homer2004development;@xian2009updating;@hollister2010volume;@hollister_predicting_2011;@lakemorpho2014;@beaulieu2013nutrients].  All datasets are national in scale and provide a unique snapshot view of the condition of lakes in the United States'.

The NLA data were collected during the summer of 2007 and the final data were released in 2009.  With consistent methods and metrics collected at 1056 locations across the conterminous United States (Figure \ref{fig:nlaMap}), the NLA provides a unique opportunity to examine broad scale patterns in lake productivity.  The NLA collected data on biophysical measures of lake water quality and habitat.  For this analysis we primarily examined the water quality measurements from the NLA [@usepa2009national].  Adding to the monitoring data collected via the NLA, we use the 2006 NLCD data to examine the possible landscape-level drivers of trophic status in lakes.  The NLCD is a nationally collected land use land cover dataset that also provides estimates of impervious surface.  We collected total land use land cover and total percent impervious surface within a 3 kilometer buffer surrounding the lake to examine larger landscape-level effect [@homer2004development;@xian2009updating]. We also used various measures of lake morphometry (i.e. depth, volume, fetch, etc.) as they are important in understanding lake productivity, yet many of these data are difficult to obtain for large numbers of lakes over broad regions.  To add this information we modeled lake morphometry [@hollister2010volume;@hollister_predicting_2011;@lakemorpho2014;@NLMDInPrep]. Lastly, to explore associations between trophic state and cyanobacteria, we used estimates of cyanobacterial biovoulme caluclated by Beaulieu *et al.* [-@beaulieu2013nutrients].  Cyanobacteria biovolumes are a truer measure of cyanobacteria dominance than abundance as there is great variability in the size within and between species.  We have consolidated the taxa level estimates from Beaulieu *et al.* [-@beaulieu2013nutrients] and  summed that information on a per-lake basis.

##Predicting Trophic State with Random Forests
Random forest is a machine learning algorithm that aggregates numerous decision trees in order to obtain a consensus prediction of the response categories [@breiman2001random].  Bootstrapped sample data is recursively partitioned according to a given random subset of predictor variables and completely grown without pruning.   With each new tree, both the sample data and predictor variable subset is randomly selected.  

While random forests are able to handle numerous correlated variables without a decrease in prediction accuracy, unusually large numbers of related variables can reduce accuracy and increase the chances of over-fitting the model.  This is a problem often faced in gene selection and in that field, a variable selection method based on random forest has been succesfully applied [@diaz2006gene].  We use varselRF in R to initially examine the importance of the water quality and GIS derived variables and select a subset, the reduced model, to then pass to random forest[@diaz-uriarte2010varSelRF]. 

Using R's randomForest package, we pass the reduced models selected with varSelRF and calculate confusion matrices, overall accuracy and kappa coeffecient [@liaw2002randomForest]. From the reduced model random forests we collect a consensus prediction and calculate a confusion matrix and summary stats.

##Model Details
Using a combination of the `varSelRF` and `randomForest` we ran models for six combinations of variables and trophic state classifications.  These combinations included different combinations of the Chlorphyll *a* trophic states (Table \ref{tab:trophicStateTable}) along with all variables and the GIS only variables (i.e. no *in situ* infromation).  The six model combinations were:


1. Chlorophyll *a* trophic state - 4 class = All variables (*in situ* water quality, lake morphometry, and landscape)
2. Chlorophyll *a* trophic state - 3 class = All variables (*in situ* water quality, lake morphometry, and landscape)
3. Chlorophyll *a* trophic state - 2 class = All variables (*in situ* water quality, lake morphometry, and landscape)
4. Chlorophyll *a* trophic state - 4 class = All variables (lake morphometry, and landscape)
5. Chlorophyll *a* trophic state - 3 class = All variables (lake morphometry, and landscape)
6. Chlorophyll *a* trophic state - 2 class = All variables (lake morphometry, and landscape)


#Results and Discussion

##Model 1: 4 Trophic States ~ All Variables
The selected variables that made up Model 1 were Potassium, Nitrogen:Phosphorus, Total Nitrogen, Total Phosphorus, Total Organic Carbon, Turbidity, Ecoregion, Organic Ions, Dissolved Organic Carbon, and Maximum Lake Depth (Table \ref{tab:VarSel_Model1}). Total accuracy for Model 1 is `r round(classAgreement(all_ts4_rf$confusion[,1:4])$diag,3)`% and the Cohen's Kappa is `r round(classAgreement(all_ts4_rf$confusion[,1:4])$kappa,3)` (Table \ref{tab:Confusion_Model1}).  

Lastly, tubidity, total phosphorus, total nitrogen, and total organic carbon were the most important predictors of the 4 classes of trophic state (Figure \ref{fig:Importance_Model1}).


##Model 2: 3 Trophic States ~ All Variables

Total accuracy for Model 2 is `r round(classAgreement(all_ts3_rf$confusion[,1:3])$diag,3)`% and the Cohen's Kappa is `r round(classAgreement(all_ts3_rf$confusion[,1:3])$kappa,3)`.

##Model 3: 2 Trophic States ~ All Variables
Total accuracy for Model 3 is `r round(classAgreement(all_ts2_rf$confusion[,1:2])$diag,3)`% and the Cohen's Kappa is `r round(classAgreement(all_ts2_rf$confusion[,1:2])$kappa,3)`.



##Model 4: 4 Trophic States ~ GIS Only Variables
Total accuracy for Model 4 is `r round(classAgreement(gis_ts4_rf$confusion[,1:4])$diag,3)`% and the Cohen's Kappa is `r round(classAgreement(gis_ts4_rf$confusion[,1:4])$kappa,3)`.


##Model 5: 3 Trophic States ~ GIS Only Variables
Total accuracy for Model 5 is `r round(classAgreement(gis_ts3_rf$confusion[,1:3])$diag,3)`% and the Cohen's Kappa is `r round(classAgreement(gis_ts3_rf$confusion[,1:3])$kappa,3)`.


##Model 6: 2 Trophic States ~ GIS Only Variables
Total accuracy for Model 6 `r round(classAgreement(gis_ts2_rf$confusion[,1:2])$diag,3)`% and the Cohen's Kappa is `r round(classAgreement(gis_ts2_rf$confusion[,1:2])$kappa,3)`.

##Associating Trophic State and Cyanobacteria
Arm waving goes here.


\newpage

#Figures

```{r figSetup,echo=FALSE,eval=TRUE,cache=TRUE}
#create list of all selected variables and assign a color
vars<-ls(pattern="_vars")
all_vars<-vector()
for(i in vars){
  all_vars<-c(all_vars,get(i))
}
all_vars<-unique(all_vars)

all_movies_palette<-vector()
for(i in 1:dim(namelist)[1]){
  all_movies_palette<-c(all_movies_palette,wes.palette(namelist[i,2],
                                                       namelist[i,1]))
}
all_movies_palette<-unique(all_movies_palette)
zissou<-c(wes.palette(5,"Zissou"),wes.palette(5,"Zissou2"))
col_lu<-data.frame(variables=all_vars,hexcode=sample(all_movies_palette,length(all_vars)))
```


```{r nlaMap, echo=FALSE, fig.cap="Map of the distribution of National Lakes Assesment Sampling locations\\label{fig:nlaMap}",cache=TRUE}
state<-map_data('state')
lakes_alb<-data.frame(ltmData[["AlbersX"]],ltmData[["AlbersY"]])
p4s<-"+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"
ll<-"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
lakes_alb_sp<-SpatialPoints(coordinates(lakes_alb),proj4string=CRS(p4s))
lakes_dd<-spTransform(lakes_alb_sp,CRS=CRS(ll))
lakes_dd<-data.frame(coordinates(lakes_dd))
mycolor<-wes.palette(5,"Zissou2")
mycolor<-c(mycolor[1],mycolor[2],mycolor[4])
names(lakes_dd)<-c("long","lat",c())
nlaMap(state,lakes_dd,mycolor)
```

\newpage

```{r Importance_Model1,results="asis",echo=FALSE, fig.cap="Importance plot for Model 1\\label{fig:Importance_Model1}",cache=TRUE}
all_ts4_color<-col_lu[["hexcode"]][col_lu[["variables"]]%in%all_ts4_vars]
importancePlot(all_ts4_rf,'gini',size=10,aes(colour=all_ts4_color))
```

\newpage

```{r Importance_Model2,results="asis",echo=FALSE, fig.cap="Importance plot for Model 2",cache=TRUE}
all_ts3_color<-col_lu[["hexcode"]][col_lu[["variables"]]%in%all_ts3_vars]
importancePlot(all_ts3_rf,'gini',size=10,aes(colour=all_ts3_color))
```

\newpage

```{r Importance_Model3,results="asis",echo=FALSE, fig.cap="Importance plot for Model 3",cache=TRUE}
all_ts2_color<-col_lu[["hexcode"]][col_lu[["variables"]]%in%all_ts2_vars]
importancePlot(all_ts2_rf,'gini',size=10,aes(colour=all_ts2_color))
```

\newpage

```{r Importance_Model4,results="asis",echo=FALSE, tab.cap="Importance plot for Model 4",cache=TRUE}
gis_ts4_color<-col_lu[["hexcode"]][col_lu[["variables"]]%in%gis_ts4_vars]
importancePlot(gis_ts4_rf,'gini',size=10,aes(colour=gis_ts4_color))
```

\newpage

```{r Importance_Model5,results="asis",echo=FALSE, fig.cap="Importance plot for Model 5",cache=TRUE}
gis_ts3_color<-col_lu[["hexcode"]][col_lu[["variables"]]%in%gis_ts3_vars]
importancePlot(gis_ts3_rf,'gini',size=10,aes(colour=gis_ts3_color))
```

\newpage

```{r Importance_Model6,results="asis",echo=FALSE, fig.cap="Importance plot for Model 6",cache=TRUE}
gis_ts2_color<-col_lu[["hexcode"]][col_lu[["variables"]]%in%gis_ts2_vars]
importancePlot(gis_ts2_rf,'gini',size=10,aes(colour=gis_ts2_color))
```

\newpage

```{r ts_4_biov, echo=FALSE, fig.width=7, fig.cap="Cumulative distribution function of cyanobacetria biovolume for 4 trophic state classes",cache=TRUE}
plotCdf(ltmData$TS_CHLA_4,ltmData$sumBioV+1,cdf_colors=zissou[6:9],
        y='Percent',x='Log10(Cyanobacteria Biovolume)',
        title=expression(paste('CDF for Chlorophyll ', 
                                italic("a"),' Trophic States (4 Categories)')),
        color="Trophic State\nCategories")
```

\newpage

```{r ts_3_biov_cdf, echo=FALSE, fig.width=7, fig.cap="Cumulative distribution function of cyanobacetria biovolume for 3 trophic state classes",cache=TRUE }
plotCdf(ltmData$TS_CHLA_3,ltmData$sumBioV+1,cdf_colors=zissou[6:8],
       y='Percent',x='Log10(Cyanobacteria Biovolume)', 
       title=expression(paste('CDF for Chlorophyll ', 
                              italic("a"),' Trophic States (3 Categories)')),
       color="Trophic State\nCategories")
```

\newpage

```{r ts_2_biov_cdf, echo=FALSE, fig.width=7, fig.cap="Cumulative distribution function of cyanobacetria biovolume for 2 trophic state classes",cache=TRUE}
plotCdf(ltmData$TS_CHLA_2,ltmData$sumBioV+1,cdf_colors=zissou[6:7],
       y='Percent',x='Log10(Cyanobacteria Biovolume)',
       title=expression(paste('CDF for Chlorophyll ', 
                              italic("a"),' Trophic States (2 Categories)')),
       color="Trophic State\nCategories")
```

\newpage

```{r scatterplot,echo=FALSE, fig.width=7, fig.cap="Cholorphyll *a* and cyanobacteria biovolume scatterplot",cache=TRUE}
scp_df<-data.frame(chla=ltmData[["CHLA"]],biovp1=ltmData[["sumBioV"]]+1)
scatterPlot(scp_df,xvar="chla",yvar="biovp1",zissou[8],zissou[7],zissou[6],
             title=expression(paste("Chlorophyll ", 
                                    italic("a")," and Cyanobacteria Relationship")),
             x=expression(paste('Log10(Chl ', italic("a"),')')),
             y="Log10(Cyanobaterial Biovolumes + 1)")
```

\newpage

#Tables

```{r trophicStateTable, results='asis', echo=FALSE, tab.cap="Chlorophyll a based trophic state cut-offs\\label{tab:trophicStateTable}",cache=TRUE}
ts_4<-c("oligo","meso","eu","hyper")
ts_3<-c("oligo","meso/eu","meso/eu","hyper")
ts_2<-c("oligo/meso","oligo/meso","eu/hyper","eu/hyper")
co<-c("<= 0.2",">2-7",">7-30",">30")
xdf<-data.frame(ts_4,ts_3,ts_2,co)
names(xdf)<-c("Trophic State (4)","Trophic State (3)","Trophic State (2)","Cut-off")
kable(xdf)
```

\newpage

```{r VarSel_Model1,results="asis",echo=FALSE, tab.cap="Variable selection results for Model 1\\label{tab:VarSel_Model1}",cache=TRUE}
kable(sumTable(all_ts4[1:100]),row.names=F)
```

\newpage

```{r Confusion_Model1,results="asis",echo=FALSE, tab.cap="Random Forest confusion matrix for Model 1\\label{tab:Confusion_Model1}",cache=TRUE}
kable(formatC(round(all_ts4_rf$confusion,2)),row.names=F)
```

\newpage

```{r VarSel_Model2,results="asis",echo=FALSE, tab.cap="Variable selection results for Model 2",cache=TRUE}
kable(sumTable(all_ts3[1:100]),row.names=F)
```

\newpage

```{r Confusion_Model2,results="asis",echo=FALSE, tab.cap="Random Forest confusion matrix for Model 2",cache=TRUE}
kable(formatC(round(all_ts3_rf$confusion,2)),row.names=F)
```

\newpage

```{r VarSel_Model3,results="asis",echo=FALSE, tab.cap="Variable selection results for Model 3",cache=TRUE}
kable(sumTable(all_ts2[1:100]),row.names=F)
```

\newpage

```{r Confusion_Model3,results="asis",echo=FALSE, tab.cap="Random Forest confusion matrix for Model 3",cache=TRUE}
kable(formatC(round(all_ts2_rf$confusion,2)),row.names=F)
```

\newpage

```{r VarSel_Model4,results="asis",echo=FALSE, tab.cap="Variable selection results for Model 4",cache=TRUE }
kable(sumTable(gis_ts4[1:100]),row.names=F)
```

\newpage

```{r Confusion_Model4,results="asis",echo=FALSE, tab.cap="Random Forest confusion matrix for Model 4",cache=TRUE }
kable(formatC(round(gis_ts4_rf$confusion,2)),row.names=F)
```

\newpage

```{r VarSel_Model5,results="asis",echo=FALSE, tab.cap="Variable selection results for Model 5",cache=TRUE}
kable(sumTable(gis_ts3[1:100]),row.names=F)
```

\newpage

```{r Conufsion_Model5,results="asis",echo=FALSE, tab.cap="Random Forest confusion matrix for Model 5",cache=TRUE}
kable(formatC(round(gis_ts3_rf$confusion,2)),row.names=F)
```

\newpage

```{r VarSel_Model6,results="asis",echo=FALSE, tab.cap="Variable selection results for Model 6",cache=TRUE}
kable(sumTable(gis_ts2[1:100]),row.names=F)
```

\newpage

```{r Confusion_Model6,results="asis",echo=FALSE, tab.cap="Random forest confusion matrix for Model 6",cache=TRUE}
kable(formatC(round(gis_ts2_rf$confusion,2)),row.names=F)
```

\newpage

#References